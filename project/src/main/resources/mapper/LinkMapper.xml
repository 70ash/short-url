<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.forzlp.project.dao.mapper.LinkMapper">

    <insert id="insertLink">
        INSERT INTO t_link (gid, domain, short_uri, full_short_url, origin_url, click_num,  valid_type, valid_time, create_time, update_time, del_flag)
        VALUES
        (#{gid}, #{domain}, #{shortUrl}, #{fullShortUrl}, #{originUrl}, #{clickNum}, #{validType}, #{validTime}, now(), now() , 0);
    </insert>
    <select id="selectByFullShortUrl" resultType="com.forzlp.project.dao.entity.Link">
        select * FROM t_link WHERE full_short_url = #{fullShortUrl} and del_flag = 0;
    </select>
    <select id="pageLink" resultType="com.forzlp.project.dto.resp.LinkSearchRespDTO">
        SELECT
            gid,
            domain,
            short_uri as shortUri,
            full_short_url AS fullShortUrl,
            origin_url AS originUrl,
            click_num AS clickNum,
            valid_type AS validType,
            valid_time AS validTime
        FROM t_link
        WHERE enable_status = 0 AND del_flag = 0 AND gid = #{gid}
        LIMIT #{current}, #{size}
    </select>
    <select id="selectOriginUrlByUriAndGid" resultType="java.lang.String">
        SELECT
            origin_url
        FROM
            t_link
        WHERE
            short_uri = #{shortUri}
          AND gid = #{gid}
    </select>
    <select id="gotoByUri" resultType="java.lang.String">
        SELECT
            gid
        FROM
            t_link
        WHERE
            short_uri = #{shortUri}
    </select>
    <select id="selectLinkByUriAndGid" resultType="com.forzlp.project.dao.entity.Link">
        SELECT * FROM t_link WHERE
            short_uri = #{shortUri}
                               AND gid = #{gid}
    </select>
</mapper>
